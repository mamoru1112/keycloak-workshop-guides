[#firstapp-project]
=== Java Script Client Adapterについて
RH-SSOには、HTML5/JavaScriptアプリケーションのセキュリティ確保に使用できるクライアントサイドJavaScriptライブラリが付属しています。
今回のアプリでは、このライブラリを使っており、Web画面上でアクセストークンなどをがアプリケーション側でどう見えるかが簡単に確認できるものになっています。

開発環境の画面に移動して、 ターミナルで `js-console`　のディレクトリに移動します。
[source, js,role="copypaste"]
----
cd js-console
----

[#firstapp-authentication]
=== JavaScirptによる認証
SSOを実現するには、アプリケーション側に、RH-SSOのURLを設定する必要があります。

SSOサーバーのURLをコピーしておきます：
OpenShiftのコマンドでSSOサーバーのホスト名は取得できます(https://は含まれてません)：
```
> oc get route sso
NAME   HOST/PORT                                              PATH   SERVICES   
sso    sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}       sso        <all>
```

`src/keycloak.json` ファイルを編集します。

以下の "auth-server-url" をSSOサーバのURLに変更します。
[source, js,role="copypaste"]
----
{
  "realm" : "demojs",
  "auth-server-url" : "https://sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}/auth",
  "resource" : "js-console"
}

----

次に、 `src/index.html` を開き、<header> <src>のSERVER_URLの部分を置き換えます。

サーバーのURLは、以下のようになります。

[source, js,role="copypaste"]
----

    <script src="https://sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}/auth/js/keycloak.js"></script>

----


基本的な設定ができたので、アプリケーションをデプロイします。
OpenShiftのS2i（Source2Image）を使って、ソースコードから一気にコンテナを作成します。
また、OpenShiftでデフォルトで提供されているhttpd(Apache Web Server)に、今回のJavaScriptを格納します。

`js-console/src` に移動して以下のコマンドを実行します。

[source, bash,role="copypaste"]
----

oc new-build --name js-console --binary --strategy source --image-stream httpd
----

Ok, so `oc new-build` should have set the right directives for our applicaiton. i.e. `js-console` which uses the httpd stream.

Lets start our build; in the following command we specify that our build will be from our local source dir.
[source,bash,subs="+macros,+attributes"]
----
oc start-build js-console --from-dir . --follow
----

Once our build is successfull, lets create a new app with that build; this will be our js-console app.
[source,bash,subs="+macros,+attributes"]
----
oc new-app --image-stream=js-console:latest
----

And finally expose a route for our service so that we can connect to it externally.
[source,bash,subs="+macros,+attributes"]
----

oc expose svc/js-console
----

[#firstapp-deployment]

image::OpenShift-first-deployment.png[First deployment, 1024]


Click on the route url and you should see the `js-console`.  This indicates that your first application was successfully deployed. But there still need to be more config done as it would return an error. As you might have noticed that we havent configured the RH-SSO for our js-console app yet.Lets go ahead and configure that. 

Click on the left menu bar item `Clients` 
A list of clients will load. 
Then Click the `Create` button

Following is the information you need to fill. 
To get the route to your js-console you can run the following command.

[source,bash,subs="+macros,+attributes"]
----
oc get route js-console
----

Fill in the details on the form (e.g. in below screenshot) and press save. Ensure you use protocol 'http://' with your route e.g. 'http://js-console-evals01-sso-kubernetes-workshop.apps.cph-5a34.open.redhat.com'(An example shown in the following screenshot)

image::sso_adminclientconfig.png[Realm Client settings]

Now go back to your browser and relaod the JS Console app. You should be redirected to the Login page

image::sso_adminloginconfig.png[Realm Login settings]

Register a new user with an email address.

image::sso_create-user.png[Create user]


After registration you should be able to login and should see the following Console with your registered users Name

image::sso_demojsconsole.png[JS Console]


Congratulations!

- Configured your first SSO JS App.

- deployed the JS App via image stream

- And how the JS Adapter works.

And it only get interesting from here on. This app is our basis for these excercises. Lets head off to the next section and what more can we do with OIDC.















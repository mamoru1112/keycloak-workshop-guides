[#firstapp-project]
=== Java Script Client Adapterについて
RH-SSOには、HTML5/JavaScriptアプリケーションのセキュリティ確保に使用できるクライアントサイドJavaScriptライブラリが付属しています。
今回のアプリでは、このライブラリを使っており、Web画面上でアクセストークンなどをがアプリケーション側でどう見えるかが簡単に確認できるものになっています。

開発環境の画面に移動して、 ターミナルで `js-console`　のディレクトリに移動します。
[source, js,role="copypaste"]
----
cd js-console
----

[#firstapp-authentication]
=== Authentication via JS
By default to authenticate you need to call the login function. 
However, there are also two options available to make the adapter automatically authenticate. You can pass login-required or check-sso to the init function. login-required will authenticate the client if the user is logged-in to RH-SSO or display the login page if not. check-sso will only authenticate the client if the user is already logged-in, if the user is not logged-in the browser will be redirected back to the application and remain unauthenticated.

You can configure a silent check-sso option. With this feature enabled, your browser won’t do a full redirect to the RH-SSO server and back to your application, but this action will be performed in a hidden iframe, so your application resources only need to be loaded and parsed once by the browser when the app is initialized and not again after the redirect back from RH-SSO to your app. This is particularly useful in case of SPAs (Single Page Applications).

In our case we use `kc.login(login)` which then redirects itself to the RH-SSO server to ensure that we have logged session. 

Make sure you copy your SSO server URL (created in the previous section):
e.g. in my case it looks something like this:
```
> oc get route sso
NAME   HOST/PORT                                              PATH   SERVICES   
sso    sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}       sso        <all>
```

or just copy it from your browser, ensure you copy the protocol also e.g. 'https://...'

Now open the `js-console/src/keycloak.json`

Change the following line "auth-server-url" with your SERVER_URL
[source, js,role="copypaste"]
----
{
  "realm" : "demojs",
  "auth-server-url" : "https://sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}/auth",
  "resource" : "js-console"
}

----

Next open the `js-console/src/index.html`
And replace the SERVER_URL in the <header> <src>

Your server URL should be as follows

[source, js,role="copypaste"]
----

    <script src="https://sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}/auth/js/keycloak.js"></script>

----


Now that you have the basic config in place, lets go ahead and deploy our applicaton.
We use the S2i (Source2Image) from OpenShift and create a stream from our project. This has some benefits. If we need to change anything in our app we will just start a new build. Incase you have missed anything, you could easily do the `start-build` again.

We also use the httpd image-stream provided by default with OpenShift. This is the Apache httpd server; hence our application will be packaged into an Apache web server.

*before starting make sure that you have Code Ready workspace `Terminal` open. 

- and also ensure that you have changed you directory too `js-console/src`
[source,bash,subs="+macros,+attributes"]
----

oc new-build --name js-console --binary --strategy source --image-stream httpd
----

Ok, so `oc new-build` should have set the right directives for our applicaiton. i.e. `js-console` which uses the httpd stream.

Lets start our build; in the following command we specify that our build will be from our local source dir.
[source,bash,subs="+macros,+attributes"]
----
oc start-build js-console --from-dir . --follow
----

Once our build is successfull, lets create a new app with that build; this will be our js-console app.
[source,bash,subs="+macros,+attributes"]
----
oc new-app --image-stream=js-console:latest
----

And finally expose a route for our service so that we can connect to it externally.
[source,bash,subs="+macros,+attributes"]
----

oc expose svc/js-console
----

[#firstapp-deployment]

image::OpenShift-first-deployment.png[First deployment, 1024]


Click on the route url and you should see the `js-console`.  This indicates that your first application was successfully deployed. But there still need to be more config done as it would return an error. As you might have noticed that we havent configured the RH-SSO for our js-console app yet.Lets go ahead and configure that. 

Click on the left menu bar item `Clients` 
A list of clients will load. 
Then Click the `Create` button

Following is the information you need to fill. 
To get the route to your js-console you can run the following command.

[source,bash,subs="+macros,+attributes"]
----
oc get route js-console
----

Fill in the details on the form (e.g. in below screenshot) and press save. Ensure you use protocol 'http://' with your route e.g. 'http://js-console-evals01-sso-kubernetes-workshop.apps.cph-5a34.open.redhat.com'(An example shown in the following screenshot)

image::sso_adminclientconfig.png[Realm Client settings]

Now go back to your browser and relaod the JS Console app. You should be redirected to the Login page

image::sso_adminloginconfig.png[Realm Login settings]

Register a new user with an email address.

image::sso_create-user.png[Create user]


After registration you should be able to login and should see the following Console with your registered users Name

image::sso_demojsconsole.png[JS Console]


Congratulations!

- Configured your first SSO JS App.

- deployed the JS App via image stream

- And how the JS Adapter works.

And it only get interesting from here on. This app is our basis for these excercises. Lets head off to the next section and what more can we do with OIDC.














